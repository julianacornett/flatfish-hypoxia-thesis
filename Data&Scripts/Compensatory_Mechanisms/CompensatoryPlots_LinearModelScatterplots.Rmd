---
title: "Compensatory Mechanism Plots - Linear Model & Scatterplots"
author: "Juliana Cornett"
date: "1/4/2022"
output: html_document
---

#Script to plot all compensatory mechanism parameters measured (Hct and Ventilation) in same plot with shared x-axis (DO)


#install packages

```{r}
#install.packages("tidyr")
#install.packages("ggplot2")
#install.packages("tidyverse")
#install.packages("ggpubr")
#install.packages("patchwork")
#install.packages("multcompView")
```

#load libraries

```{r}
library(tidyr)
library(ggplot2)
library(tidyverse)
library(ggpubr)
library(patchwork)
library(multcompView)
```

#DATA PREPARATION 

#read in csv file containing all measurements for each species

```{r}
PvetAll <- read.csv("../Data/Pvet_AllVars.csv")

CstigAll <- read.csv("../Data/Cstig_AllVars.csv")
```

#select only ID, Species, DO, Hct, AmbVent, and HypVent columns

```{r}
PvetComp <- select(PvetAll, c("ID", "Species", "DO", "Hct", "AmbVent", "HypVent"))

CstigComp <- select(CstigAll, c("ID", "Species", "DO", "Hct", "AmbVent", "HypVent"))
```

#create ventilation rate change column (hypVent - AmbVent)

```{r}
PvetComp$VentChange <- (PvetComp$HypVent - PvetComp$AmbVent)

CstigComp$VentChange <- (CstigComp$HypVent - CstigComp$AmbVent)
```

#SCATTERPLOTS & LINEAR MODEL - PLOTS COMBINED with PATCHWORK 

#separate p1 (Hct) & p2 (Vent) plots
#then specify stacking with patchwork with "p1/p2"

#English sole

#linear models 

#ventilation

```{r}
soleVent_lm <- lm(PvetComp$VentChange ~ PvetComp$DO)
print(summary(soleVent_lm))
```

#Hct

```{r}
soleHct_lm <- lm(PvetComp$Hct ~ PvetComp$DO)
print(summary(soleHct_lm))
```

```{r}
jpeg("EnglishSole_CompScatter_Patchwork.jpg", width = 14, height = 11, units="in", res=1200)

sole_comp_scatter_p1 <- ggplot(PvetComp, aes(x = DO, y = Hct)) +
  geom_point(fill = "lightskyblue1", shape = 21, size = 5) +
  theme_pubr() +
  geom_smooth(method = "lm", color ="black", se = FALSE) +
  stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "*`,`~")), size = 6) +
  theme(axis.text = element_text(size=14), axis.title = element_text(size=18, face="bold")) +
  xlab("DO (mg/L)") +
  ylab("Hematocrit (%)") +
  ylim(15,40)

sole_comp_scatter_p2 <- ggplot(PvetComp, aes(x = DO, y = VentChange)) +
  geom_point(fill = "lightskyblue1", shape = 21, size = 5) +
  theme_pubr() +
  geom_smooth(method = "lm", color ="black", se = FALSE) +
  geom_text(aes(x=2, y=30, label= "R^2 == 0.23~~~p < 0.001"), parse=TRUE, size=6) +
  theme(axis.text = element_text(size=14), axis.title = element_text(size=18, face="bold")) +
  xlab("DO (mg/L)") +
  ylab("Change in Ventilation (breaths/min)")

sole_comp_scatter_p1 / sole_comp_scatter_p2

dev.off()
```

#Speckled sanddabs

#linear models 

#ventilation

```{r}
dabVent_lm <- lm(CstigComp$VentChange ~ CstigComp$DO)
print(summary(dabVent_lm))
```

#Hct

```{r}
dabHct_lm <- lm(CstigComp$Hct ~ CstigComp$DO)
print(summary(dabHct_lm))
```

```{r}
jpeg("Sanddabs_CompScatter_Patchwork.jpg", width = 14, height = 11, units="in", res=1200)

dab_comp_scatter_p1 <- ggplot(CstigComp, aes(x = DO, y = Hct)) +
  geom_point(fill = "lightgoldenrod2", shape = 21, size = 5) +
  theme_pubr() +
  geom_smooth(method = "lm", color ="black", se = FALSE) +
  stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "*`,`~")), label.x = 1.75, size = 6) +
  theme(axis.text = element_text(size=14), axis.title = element_text(size=18, face="bold")) +
  xlab("DO (mg/L)") +
  ylab("Hematocrit (%)") +
  ylim(20,50)

dab_comp_scatter_p2 <- ggplot(CstigComp, aes(DO, VentChange) ) +
  geom_point(fill = "lightgoldenrod2", shape = 21, size = 5) +
  theme_pubr() +
  stat_smooth(method='lm', color="black", se = FALSE, formula = y ~ poly(x, 2)) +
  theme(axis.text = element_text(size=14), axis.title = element_text(size=18, face="bold")) +
  xlab("DO (mg/L)") +
  ylab("Change in Ventilation Rate (breaths/min)") +
  geom_text(aes(x=2.5, y=42, label= "R^2 == 0.7101~~~p < 0.001"), parse=TRUE, size=6)

dab_comp_scatter_p1 / dab_comp_scatter_p2

dev.off()
```

```{r}
jpeg("Ventilation_BothSpecies.jpg", width = 14, height = 6, units="in", res=1200)

sole_vent_scatter_p1 <- ggplot(PvetComp, aes(x = DO, y = VentChange)) +
  geom_point(fill = "lightskyblue1", shape = 21, size = 5) +
  theme_pubr() +
  geom_smooth(method = "lm", color ="black", se = FALSE) +
  geom_text(aes(x=3, y=31, label= "R^2 == 0.23~~~p < 0.001"), parse=TRUE, size=6) +
  theme(axis.text = element_text(size=14), axis.title = element_text(size=18, face="bold")) +
  xlab("DO (mg/L)") +
  ylab("Change in Ventilation (breaths/min)")

dab_vent_scatter_p2 <- ggplot(CstigComp, aes(DO, VentChange) ) +
  geom_point(fill = "lightgoldenrod2", shape = 21, size = 5) +
  theme_pubr() +
  stat_smooth(method='lm', color="black", se = FALSE, formula = y ~ poly(x, 2)) +
  theme(axis.text = element_text(size=14), axis.title = element_text(size=18, face="bold")) +
  xlab("DO (mg/L)") +
  ylab("Change in Ventilation Rate (breaths/min)") +
  geom_text(aes(x=3, y=42, label= "R^2 == 0.7101~~~p < 0.001"), parse=TRUE, size=6)


sole_vent_scatter_p1 | dab_vent_scatter_p2

dev.off()
```

